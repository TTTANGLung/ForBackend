<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Table Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            display: flex;
        }

        .sidebar {
            width: 200px;
            padding: 20px;
            border-right: 1px solid #ccc;
            background-color: #fff;
        }

        .sidebar h2 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .table-name {
            cursor: pointer;
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f2f2f2;
            transition: background-color 0.3s;
        }

        .table-name:hover {
            background-color: #e0e0e0;
        }

        .content {
            padding: 20px;
            flex-grow: 1;
        }

        .no-data {
            margin-top: 20px;
            color: #a94442;
        }

        .button-container {
            margin-bottom: 20px;
        }

        button {
            margin-right: 10px;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .selected {
            background-color: #d1ecf1;
        }

        .data-list {
            list-style-type: none;
            padding: 0;
        }

        .data-list li {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f2f2f2;
            cursor: pointer;
        }

        .data-list li:hover {
            background-color: #e0e0e0;
        }

        .editable {
            margin-top: 20px;
        }

        .editable div {
            margin-bottom: 10px;
        }

        .editable input {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: calc(100% - 10px);
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <h2>Tables</h2>
        <div id="tablesList"></div>
    </div>
    <div class="content">
        <h2 id="tableTitle">Select a table to view data</h2>
        <div class="button-container">
            <button id="deleteButton" style="display:none;">Delete Selected</button>
            <button id="editButton" style="display:none;">Edit Selected</button>
        </div>
        <ul id="tableData" class="data-list">No data to display.</ul>

        <div id="editContainer" class="editable" style="display:none;"></div>
        <button id="saveButton" style="display:none;">Save Changes</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBXFDGnPsoodXXfHcWhDWgpDRHm9pmupAo",
            authDomain: "fypfirebase-c8e60.firebaseapp.com",
            databaseURL: "https://fypfirebase-c8e60-default-rtdb.firebaseio.com",
            projectId: "fypfirebase-c8e60",
            storageBucket: "fypfirebase-c8e60.firebasestorage.app",
            messagingSenderId: "568745497962",
            appId: "1:568745497962:web:069b367303ccded5484113",
            measurementId: "G-KMJ26VBPV5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentCollection = '';
        let selectedDocId = '';

        async function loadCollections() {
            const collectionsList = await getDocs(collection(db, '/travelData')); 
            const tablesListDiv = document.getElementById('tablesList');

            collectionsList.forEach((doc) => {
                const div = document.createElement('div');
                div.className = 'table-name';
                div.innerText = doc.id;
                div.onclick = () => loadCollectionData(doc.id);
                tablesListDiv.appendChild(div);
            });
        }

        async function loadCollectionData(collectionName) {
            currentCollection = collectionName;
            const tableDataDiv = document.getElementById('tableData');
            const tableTitle = document.getElementById('tableTitle');
            tableTitle.innerText = `Data from ${collectionName}`;
            tableDataDiv.innerHTML = '';

            const collectionRef = collection(db, collectionName);
            const querySnapshot = await getDocs(collectionRef);

            if (querySnapshot.empty) {
                tableDataDiv.innerHTML = '<li class="no-data">No data to display.</li>';
                return;
            }

            querySnapshot.forEach(doc => {
                const data = doc.data();
                const rowId = doc.id;

                const listItem = document.createElement('li');
                listItem.setAttribute('data-id', rowId);

                Object.entries(data).forEach(([key, value]) => {
                    listItem.innerHTML += `<strong>${key}:</strong> <span class="value">${value}</span><br>`;
                });

                listItem.onclick = () => {
                    selectedDocId = rowId;
                    document.querySelectorAll('.data-list li').forEach(li => li.classList.remove('selected'));
                    listItem.classList.add('selected');
                    document.getElementById('deleteButton').style.display = 'inline-block';
                    document.getElementById('editButton').style.display = 'inline-block';

                    populateEditFields(data);
                };

                tableDataDiv.appendChild(listItem);
            });
        }

        function populateEditFields(data) {
            const editContainer = document.getElementById('editContainer');
            editContainer.innerHTML = '';
            Object.entries(data).forEach(([key, value]) => {
                const div = document.createElement('div');
                div.innerHTML = `<strong>${key}:</strong>`;
                const input = document.createElement('input');
                input.type = 'text';
                input.value = value; 
                input.setAttribute('data-key', key);
                div.appendChild(input);
                editContainer.appendChild(div);
            });
            editContainer.style.display = 'block';
            document.getElementById('saveButton').style.display = 'inline-block';
        }

        document.getElementById('deleteButton').onclick = async function () {
            if (selectedDocId) {
                const docRef = doc(db, currentCollection, selectedDocId);
                await deleteDoc(docRef);
                alert('Document deleted!');
                loadCollectionData(currentCollection);
                document.getElementById('editContainer').style.display = 'none'; 
                document.getElementById('saveButton').style.display = 'none';
            }
        };

        
        document.getElementById('saveButton').onclick = async function () {
            if (selectedDocId) {
                const inputs = document.querySelectorAll('#editContainer input');
                const updates = {};
                inputs.forEach(input => {
                    const key = input.getAttribute('data-key');
                    updates[key] = input.value; 
                });
                const docRef = doc(db, currentCollection, selectedDocId);
                await updateDoc(docRef, updates);
                alert('Document updated!');
                loadCollectionData(currentCollection);
            }
        };

        loadCollections();
    </script>
</body>

</html>